<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.nff.repository.dao.statDAO">

	<!-- 전체 단골 등록 수 -->
	<select id="frequentCountAll" resultType="int">
		select count(*)
		from tb_frequent_store
	</select>

	<!-- store 단골 랭킹 리스트 -->
	<select id="statFrequentStore" parameterType="Search"
		resultType="Stat">
		 select fv.store_no,
		store_name,
		store_owner,
		status,
		store_tell,
		(select count(user_no) from tb_frequent_store f where fv.store_no = f.store_no) as frequentCnt,
		open_time,
		close_time,
		(select c.category_name
		from tb_category
		as c
		where store_category = c.category_no) as category_name,
         (select a.street_load
		from tb_address as a
		where fv.store_no = a.store_no) as street_load
		from
		frequent_view as fv
        inner join tb_frequent_store f
        on fv.store_no = f.store_no
         inner join tb_address a
        on fv.store_no = a.store_no
		group by fv.store_no
		order by frequentCnt desc

		<!-- 페이징 -->
		LIMIT #{startList}, #{listSize}

	</select>
	

	<!-- 연령별 필터 -->
		<sql id="statAgeFilter">
		<if test="ageCode != null and ageCode != ''">
		and user_age in
			<foreach item="age" index="index"
				collection="ageCode" open="(" separator="," close=")">
				#{age.value}
			</foreach>
		</if>
	</sql>
	<!-- 성별 필터 -->
		<sql id="statGenderFilter">
		<if test="type != null and type != ''">
			and user_gender like '%' || #{type} || '%'
		</if>
	</sql>
</mapper>