<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.nff.repository.dao.StoreDAO">
   <select id="selectOneStore" resultType="Store">
      select s.store_no, 
      		 s.stroe_name,
      		 s.store_tell,
      		 s.open_time,
      		 s.close_time,
      		 a.city, a.street_load,
      		 m.menu, m.price
      		 w.week_name
        from tb_store as s
        inner join tb_store_menu as m
        on s.store_no = m.store_no
        inner join tb_area as a
        on s.area_code = a.area_code
        inner join tb_holiday as h
        on s.store_no = h.store_no
        inner join tb_week as w
        on h.week_no = w.week_name
        where store_no = 1 
   </select>
   
   <select id="storeList" resultType="Store" parameterType="Search">
   		select distinct s.*,
			   c.category_name as category,
       		   ifnull(round(r.scope, 1), 0) scope,
               ifnull(r.count, 0) rcount
  		  from tb_store s
	left outer join (select store_no, COUNT(*) count, avg(store_scope) scope
                       from tb_review
				      group by store_no) r
    	    on s.store_no = r.store_no
		 inner join tb_category c
            on s.store_category = c.category_no
           <!--  where str_to_date(s.open_time, '%h:%i %p') < now()
              and str_to_date(s.close_time, '%h:%i %p') > now() -->
   </select>

</mapper>
