<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.nff.repository.dao.LoginDAO">
<resultMap type="Store" id="storeMap">
		<result column="store_no" property="storeNo" />
		<result column="store_name" property="storeName" />
		<result column="store_email" property="storeEmail" />
		<result column="store_pass" property="storePass" />
		<result column="store_tell" property="storeTell" />
		<result column="store_category" property="storeCategory" />
		<result column="open_time" property="openTime" />
		<result column="close_time" property="closeTime" />
		<result column="status" property="status" />
		<result column="business_num" property="businessNum" />
		<result column="store_owner" property="storeOwner" />
		<result column="store_owner_ph" property="storeOwnerPh" />
		<result column="latitude" property="latitude" />
		<result column="longitude" property="longitude" />
		<result column="store_join_date" property="storeJoinDate" />
		<result column="price_type" property="priceType" />
		<result column="see_cnt" property="seeCnt" />
		<result column="store_scope_total" property="storeScopeTotal" />
		<result column="review_cnt_total" property="reviewCntTotal" />

		<collection property="holidayList" column="store_no"
			select="selectHolidayListByStoreNo" />
	</resultMap>
	
	<!-- 일반회원 가입(naver) -->
	<insert id="insertNaverUser" parameterType="User" >
		insert into tb_user (user_id, user_name, user_email, user_gender, user_age) values
			(#{userId},#{userName},#{userEmail},#{userGender},#{userAge})
	</insert>
	
	<!-- 일반회원 가입(kakao) -->
	<insert id="insertKakaoUser" parameterType="User">
		insert into tb_user (user_id, user_name, user_email, user_gender, user_age) values
			(#{userId},#{userName},#{userEmail},#{userGender},#{userAge})
	</insert>
	
	<!-- naver 회원 체크 -->
	<select id="selectNaver" resultType="int" parameterType="User">
		select count(*) from tb_user 
			where user_email = #{userEmail}
	</select>
	
	<!-- 카카오 회원 체크 -->
	<select id="selectKakao" resultType="int" parameterType="User">
		select count(*) from tb_user 
			where user_email = #{userEmail}
	</select>
	
	<!-- 카카오 회원정보 입력 -->
	<update id="insertKakaoInfo" parameterType="User">
		update tb_user 
			set user_gender = #{userGender} , user_age = #{userAge} 
			where (user_no = #{userNo})
	</update>
	
	<!-- 회원정보 가져오기 -->
	<select id="selectLoginOneUser" resultType="User" parameterType="User">
		select * from tb_user
			where user_email = #{userEmail}
	</select>
	<!-- 가게 이메일 중복체크 -->
	<select id="storeEmailChk" parameterType="String" resultType="int" flushCache="true" useCache="true">
		select count(*) from tb_store where store_email = #{storeEmail}
	</select>
	
	<!-- 가게 회원가입(휴일 제외 정보 insert) -->
	<insert id="insertStore" parameterType="Store">
		insert into tb_store 
			(
			store_name, business_num, store_email, 
			store_pass, store_tell, store_category, 
			open_time, close_time,
			store_owner, store_owner_ph
			) values (
			#{storeName}, #{businessNum}, #{storeEmail}, 
			#{storePass}, #{storeTell}, #{storeCategory},
			#{openTime},#{closeTime}, #{storeOwner},#{storeOwnerPh}
			)
	</insert>
	
	<!-- 가게 회원가입(휴일 정보 insert) -->
	<insert id="insertHoliday" parameterType="Store">
		<selectKey keyProperty="storeNo" resultType="int" order="BEFORE">
			select max(store_no) from tb_store 
		</selectKey>
			INSERT INTO tb_holiday VALUES
			<foreach collection="day" item="weekNo" separator=",">
				(#{weekNo}, #{storeNo} )
			</foreach>
	</insert>
	
	<!-- 가게 회원가입(주소정보 insert) -->
	<insert id="insertAddress" parameterType="Store">
		<selectKey keyProperty="storeNo" resultType="int" order="BEFORE">
			select max(store_no) from tb_store 
		</selectKey>
		insert into tb_address values 
			(#{storeNo}, #{sggNm}, #{roadFullAddr}, #{entX}, #{entY})
	</insert>
	
	<!-- 가게 회원가입(메뉴정보 insert) -->
	 <insert id="insertMenuList" parameterType="Store">
		<selectKey keyProperty="storeNo" resultType="int" order="BEFORE">
			select max(store_no) from tb_store 
		</selectKey>
		insert into tb_store_menu values
			<foreach collection="menu" item="menu" separator=",">
				#{menu}
			</foreach>
			<foreach collection="menu" item="price" separator=",">
				#{price}
			</foreach>
		
	</insert>
	
	<!-- 가게회원 로그인체크 -->
	<select id="storeLogin" parameterType="Store" resultType="Store">
	 select * 
	  from tb_store
	  where store_email = #{storeEmail} 
	  and store_pass = #{storePass}
	</select>
	

	
	
	
</mapper>  